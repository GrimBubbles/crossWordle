<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dne≈°n√≠ K≈ô√≠≈æovka</title>
    <!-- Tailwind CSS pro styly -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS PRO M≈ò√ç≈ΩKU */
        .crossword-grid {
            display: grid;
            gap: 1px;
            background-color: #374151; /* Barva m≈ô√≠≈æky (≈°ed√°) */
            border: 2px solid #374151;
            margin: 0 auto;
            /* Zamezen√≠ zoomov√°n√≠ na mobilu p≈ôi double-tapu */
            touch-action: manipulation; 
        }

        .cell {
            position: relative;
            background-color: white;
            aspect-ratio: 1; /* ƒåtvercov√Ω tvar */
        }

        /* Styl pro ƒçern√°/pr√°zdn√° pol√≠ƒçka */
        .cell.black {
            background-color: #1f2937; /* Tmavƒõ ≈°ed√° */
        }

        /* Zv√Ωraznƒõn√≠ tajenky */
        .cell.tajenka {
            background-color: #fef08a; /* ≈Ωlut√° */
        }

        /* Vstupn√≠ pol√≠ƒçko pro p√≠smeno */
        .cell input {
            width: 100%;
            height: 100%;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            border: none;
            background: transparent;
            outline: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
            color: #111827;
            border-radius: 0; /* Fix pro iOS */
        }

        .cell input:focus {
            background-color: #bfdbfe; /* Modr√° p≈ôi psan√≠ */
        }

        /* ƒå√≠slo ≈ô√°dku v rohu */
        .cell-number {
            position: absolute;
            top: 1px;
            left: 2px;
            font-size: 0.65rem;
            color: #6b7280;
            pointer-events: none;
            line-height: 1;
        }

        /* Legenda */
        .clue-item {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .clue-item:hover {
            background-color: #eff6ff;
        }

        /* Naƒç√≠tac√≠ koleƒçko */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Responzivita pro mal√© displeje */
        @media (max-width: 600px) {
            .cell input { font-size: 1rem; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col font-sans">

    <!-- HLAVN√ç OBSAH -->
    <main class="flex-grow p-4">
        <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden min-h-[600px]">
            
            <!-- Hlaviƒçka -->
            <header class="bg-blue-600 text-white p-6 text-center">
                <h1 class="text-3xl font-extrabold mb-1">Dne≈°n√≠ K≈ô√≠≈æovka</h1>
                <p class="text-blue-100 text-sm opacity-90">Vylu≈°ti tajenku a odhal t√©ma</p>
                
                <div class="mt-4 inline-block bg-blue-700 bg-opacity-50 px-4 py-1 rounded-full text-sm backdrop-blur-sm">
                    T√©ma: <span id="theme-display" class="font-bold text-white">Naƒç√≠t√°n√≠...</span>
                </div>
            </header>

            <!-- Loading obrazovka -->
            <div id="loading-state" class="py-20 text-center">
                <div class="loader"></div>
                <p class="text-gray-500 mt-4">Stahuji k≈ô√≠≈æovku...</p>
            </div>

            <!-- Error obrazovka -->
            <div id="error-state" class="hidden py-20 text-center px-4">
                <div class="text-5xl mb-4">üòï</div>
                <h2 class="text-xl font-bold text-gray-800">Nƒõco se pokazilo</h2>
                <p class="text-gray-600 mt-2 text-sm" id="error-message">Nepoda≈ôilo se naƒç√≠st data.</p>
                <button onclick="location.reload()" class="mt-6 bg-blue-600 text-white px-6 py-2 rounded shadow hover:bg-blue-700 transition">Zkusit znovu</button>
            </div>

            <!-- Hern√≠ rozhran√≠ (skryt√© p≈ôi naƒç√≠t√°n√≠) -->
            <div id="game-content" class="hidden flex flex-col lg:flex-row">
                
                <!-- Lev√° ƒç√°st: M≈ô√≠≈æka -->
                <div class="flex-1 p-6 flex flex-col items-center border-b lg:border-b-0 lg:border-r border-gray-100">
                    
                    <div id="grid-container" class="crossword-grid shadow-md mb-8">
                        <!-- M≈ô√≠≈æka se vygeneruje zde -->
                    </div>

                    <!-- Tlaƒç√≠tka -->
                    <div class="flex gap-3 w-full justify-center max-w-md">
                        <button onclick="checkGame()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg shadow font-bold transition flex justify-center items-center gap-2">
                            <span>‚úì</span> Zkontrolovat
                        </button>
                        <button onclick="revealLetter()" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white py-3 rounded-lg shadow font-bold transition flex justify-center items-center gap-2">
                            <span>?</span> N√°povƒõda
                        </button>
                    </div>

                    <div id="status-msg" class="mt-6 font-bold h-6 text-center"></div>
                </div>

                <!-- Prav√° ƒç√°st: Legenda -->
                <div class="w-full lg:w-80 bg-gray-50 p-6 flex flex-col h-auto lg:h-auto">
                    <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">LEGENDA</h3>
                    
                    <div class="space-y-6 overflow-y-auto max-h-[500px] pr-2">
                        <!-- Svisle (Tajenka) -->
                        <div class="bg-amber-100 rounded-lg p-3 border border-amber-200">
                            <h4 class="font-bold text-amber-800 text-xs uppercase tracking-wide mb-1">Svisle (Tajenka)</h4>
                            <div id="tajenka-clue" class="font-bold text-gray-900 text-sm">...</div>
                        </div>

                        <!-- Vodorovnƒõ -->
                        <div>
                            <h4 class="font-bold text-gray-500 text-xs uppercase tracking-wide mb-2">Vodorovnƒõ</h4>
                            <ul id="clues-list" class="space-y-2 text-sm">
                                <!-- Seznam se vygeneruje zde -->
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <footer class="text-center py-4 text-gray-400 text-xs">
        &copy; <script>document.write(new Date().getFullYear())</script> Generov√°no pomoc√≠ AI & GitHub Actions
    </footer>

    <!-- LOGIKA APLIKACE -->
    <script>
        // URL k JSON souboru ve slo≈æce data/daily
        const JSON_URL = 'data/daily/daily_crossword.json';

        let gameState = {
            grid: [],
            width: 0,
            height: 0,
            clues: []
        };

        // Start
        async function init() {
            try {
                // Cache busting parameter (?t=...) zajist√≠, ≈æe dostaneme v≈ædy ƒçerstv√° data
                const response = await fetch(`${JSON_URL}?t=${new Date().getTime()}`);
                
                if (!response.ok) throw new Error(`HTTP Error ${response.status}`);
                
                const rawData = await response.json();
                processData(rawData); // P≈ôevod dat
                renderGame();         // Vykreslen√≠
                
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('game-content').classList.remove('hidden');

            } catch (error) {
                console.error("Chyba:", error);
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('error-state').classList.remove('hidden');
                document.getElementById('error-message').innerText = `Data nejsou dostupn√° (${error.message})`;
            }
        }

        // P≈ôevod "kostry" (seznam slov) na 2D m≈ô√≠≈æku
        function processData(data) {
            const meta = data.meta;
            document.getElementById('theme-display').innerText = meta.theme;
            document.getElementById('tajenka-clue').innerText = `Tajenka na ${meta.height} p√≠smen`;

            const width = meta.width;
            const height = meta.height;
            
            // Vytvo≈ô√≠me pr√°zdnou m≈ô√≠≈æku
            const grid = Array(height).fill().map(() => Array(width).fill('#'));
            const clues = [];

            // Napln√≠me m≈ô√≠≈æku slovy
            data.grid_data.forEach((item, index) => {
                const r = item.row;
                const word = item.word;
                const startC = item.start_col;
                const isBonus = item.is_bonus;

                // Z√°pis p√≠smen do m≈ô√≠≈æky
                for (let i = 0; i < word.length; i++) {
                    const c = startC + i;
                    if (c < width) {
                        grid[r][c] = {
                            char: word[i],
                            isTajenka: (i === item.tajenka_idx_in_word), // Je toto p√≠smeno souƒç√°st√≠ tajenky?
                            rowNum: (i === 0 && !isBonus) ? (index + 1) : null // ƒå√≠slo ≈ô√°dku (jen na zaƒç√°tku slova)
                        };
                    }
                }

                // P≈ôid√°n√≠ legendy (pokud to nen√≠ jen n√°hodn√© p√≠smeno zdarma)
                if (!isBonus) {
                    clues.push({
                        num: index + 1,
                        text: item.clue,
                        row: r,
                        col: startC
                    });
                }
            });

            gameState.grid = grid;
            gameState.width = width;
            gameState.height = height;
            gameState.clues = clues;
        }

        function renderGame() {
            const container = document.getElementById('grid-container');
            const cluesList = document.getElementById('clues-list');

            // 1. Nastaven√≠ Gridu (sloupce)
            container.style.gridTemplateColumns = `repeat(${gameState.width}, 1fr)`;
            
            // V√Ωpoƒçet velikosti bu≈àky (aby se ve≈°la na obrazovku)
            // Vezmeme ≈°√≠≈ôku okna, odeƒçteme paddingy a podƒõl√≠me poƒçtem sloupc≈Ø
            const availableWidth = Math.min(window.innerWidth - 40, 600); // Max ≈°√≠≈ôka m≈ô√≠≈æky cca 600px
            const cellSize = Math.floor(availableWidth / gameState.width);
            const finalCellSize = Math.min(cellSize, 35); // Max 35px na bu≈àku

            // 2. Vykreslen√≠ bunƒõk
            gameState.grid.forEach((row, r) => {
                row.forEach((cellData, c) => {
                    const cellDiv = document.createElement('div');
                    cellDiv.style.width = `${finalCellSize}px`;
                    cellDiv.style.height = `${finalCellSize}px`;

                    if (cellData === '#') {
                        cellDiv.className = 'cell black';
                    } else {
                        cellDiv.className = `cell ${cellData.isTajenka ? 'tajenka' : ''}`;
                        
                        // ƒå√≠slo
                        if (cellData.rowNum) {
                            const span = document.createElement('span');
                            span.className = 'cell-number';
                            span.innerText = cellData.rowNum;
                            cellDiv.appendChild(span);
                        }

                        // Input
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.maxLength = 1;
                        input.dataset.r = r;
                        input.dataset.c = c;
                        input.dataset.correct = cellData.char;
                        
                        // Ud√°losti
                        input.addEventListener('keydown', handleInput);
                        input.addEventListener('click', (e) => e.target.select()); // Vybrat text p≈ôi kliku

                        cellDiv.appendChild(input);
                    }
                    container.appendChild(cellDiv);
                });
            });

            // 3. Vykreslen√≠ legendy
            gameState.clues.forEach(clue => {
                const li = document.createElement('li');
                li.className = 'clue-item p-2 rounded flex gap-2 items-start';
                li.innerHTML = `<span class="font-bold text-blue-600 min-w-[20px]">${clue.num}.</span> <span>${clue.text}</span>`;
                
                // Kliknut√≠ na legendu hod√≠ focus na slovo
                li.onclick = () => {
                    const inp = document.querySelector(`input[data-r="${clue.row}"][data-c="${clue.col}"]`);
                    if(inp) {
                        inp.focus();
                        inp.scrollIntoView({behavior: "smooth", block: "center"});
                    }
                };
                
                cluesList.appendChild(li);
            });
        }

        // Navigace ≈°ipkami
        function handleInput(e) {
            const input = e.target;
            const r = parseInt(input.dataset.r);
            const c = parseInt(input.dataset.c);
            let next;

            // ≈†ipky
            if (e.key === 'ArrowRight') next = findInput(r, c + 1);
            if (e.key === 'ArrowLeft') next = findInput(r, c - 1);
            if (e.key === 'ArrowDown') next = findInput(r + 1, c);
            if (e.key === 'ArrowUp') next = findInput(r - 1, c);

            // Backspace (sma≈æe a jde doleva)
            if (e.key === 'Backspace' && input.value === '') {
                next = findInput(r, c - 1);
            }

            // Automatick√Ω posun p≈ôi psan√≠ p√≠smen
            if (!next && e.key.length === 1 && e.key.match(/[a-zA-Z√°ƒçƒè√©ƒõ√≠≈à√≥≈ô≈°≈•√∫≈Ø√Ω≈æ√Åƒåƒé√âƒö√ç≈á√ì≈ò≈†≈§√ö≈Æ√ù≈Ω]/)) {
                setTimeout(() => {
                    const nextAuto = findInput(r, c + 1);
                    if (nextAuto) nextAuto.focus();
                }, 10);
            }

            if (next) {
                e.preventDefault(); // Zastavit scrollov√°n√≠ str√°nky
                next.focus();
            }
        }

        function findInput(r, c) {
            return document.querySelector(`input[data-r="${r}"][data-c="${c}"]`);
        }

        // Kontrola
        function checkGame() {
            const inputs = document.querySelectorAll('input');
            let errors = 0;
            let empty = 0;

            inputs.forEach(inp => {
                const val = inp.value.toUpperCase();
                const correct = inp.dataset.correct;

                // Reset styl≈Ø
                inp.classList.remove('text-red-600', 'text-green-600', 'bg-red-50');

                if (!val) {
                    empty++;
                } else if (val !== correct) {
                    errors++;
                    inp.classList.add('text-red-600', 'bg-red-50');
                } else {
                    inp.classList.add('text-green-600');
                }
            });

            const status = document.getElementById('status-msg');
            if (errors === 0 && empty === 0) {
                status.innerText = "üéâ GRATULUJI! TAJENKA VYLU≈†TƒöNA! üéâ";
                status.className = "mt-6 font-bold h-6 text-center text-green-600 animate-bounce";
            } else {
                status.innerText = `Chyb: ${errors}, Pr√°zdn√Ωch: ${empty}`;
                status.className = "mt-6 font-bold h-6 text-center text-red-500";
            }
        }

        // N√°povƒõda
        function revealLetter() {
            const inputs = Array.from(document.querySelectorAll('input'));
            // Najdi pr√°zdn√° nebo ≈°patn√°
            const candidates = inputs.filter(i => i.value.toUpperCase() !== i.dataset.correct);
            
            if (candidates.length > 0) {
                const rand = candidates[Math.floor(Math.random() * candidates.length)];
                rand.value = rand.dataset.correct;
                rand.classList.add('text-blue-600', 'font-bold');
                // Vizu√°ln√≠ efekt
                const parent = rand.parentElement;
                parent.style.backgroundColor = '#93c5fd';
                setTimeout(() => {
                    // Pokud je to tajenka, vr√°tit ≈ælutou, jinak b√≠lou
                    parent.style.backgroundColor = ''; 
                }, 500);
            }
        }

        // Spustit
        init();

    </script>
</body>
</html>
